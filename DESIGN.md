# URL Shortener Microservice - Design Document

## Overview
This microservice provides URL shortening functionality with a RESTful API. It allows clients to create shortened URLs with optional custom shortcodes and expiry times, and supports redirection from shortcodes to original URLs.

## Architecture
- **Framework:** FastAPI, a modern, fast (high-performance) web framework for building APIs with Python 3.7+ based on standard Python type hints.
- **Data Storage:** In-memory dictionary (`url_store`) to map shortcodes to original URLs and expiry timestamps.
- **API Endpoints:**
  - `POST /shorturls`: Create a new shortened URL.
  - `GET /{shortcode}`: Redirect to the original URL if shortcode is valid and not expired.

## Data Modeling
- **Request Model (`ShortenURLRequest`):**
  - `url` (HttpUrl): The original URL to shorten. Validated by Pydantic.
  - `validity` (Optional[int]): Duration in minutes for which the short URL is valid. Defaults to 30 minutes.
  - `shortcode` (Optional[str]): Custom shortcode. If omitted, a random shortcode is generated.

- **Response Model (`ShortenURLResponse`):**
  - `shortLink` (str): The full shortened URL.
  - `expiry` (str): Expiry timestamp in ISO 8601 format.

## Technology Choices and Justifications
- **FastAPI:** Chosen for its speed, ease of use, automatic validation, and automatic API documentation generation.
- **Pydantic:** For data validation and serialization.
- **In-memory store:** Simple and fast for demonstration and testing purposes. Not suitable for production; a persistent store like Redis or a database would be needed.
- **Logging:** Python's built-in logging module for traceability and debugging.

## Assumptions
- The service runs on a single instance; no distributed state management.
- Shortcodes are unique within the in-memory store.
- Expired shortcodes are removed upon access.
- No authentication or rate limiting is implemented.
- The base URL is `http://localhost:8000/` (should be configurable in production).

## Scalability and Maintainability
- **Scalability:**
  - The current in-memory store limits scalability and persistence.
  - For production, replace with a distributed cache or database (e.g., Redis, DynamoDB).
  - Add background jobs to clean expired entries.
  - Use a load balancer and multiple instances for high availability.

- **Maintainability:**
  - Clear separation of concerns with Pydantic models.
  - Logging for monitoring and debugging.
  - API documentation auto-generated by FastAPI.
  - Code structured for easy extension (e.g., adding authentication, analytics).

## Error Handling
- Duplicate shortcode creation returns HTTP 400.
- Shortcode not found returns HTTP 404.
- Expired shortcode returns HTTP 410.
- Failure to generate unique shortcode returns HTTP 500.

## Future Improvements
- Persistent storage integration.
- Authentication and rate limiting.
- Analytics and usage tracking.
- Custom domain support.
- UI for managing short URLs.
